(()=>{var e={507:()=>{const e=document.querySelector("#type"),t=document.querySelector("#price"),o=document.querySelector("#timein"),a=document.querySelector("#timeout"),r=document.querySelector("#capacity"),l=document.querySelector("#room_number"),n=document.querySelector(".ad-form-header__input"),c=document.querySelector(".ad-form-header__preview").querySelector("img"),s=document.querySelector(".ad-form__input"),u=document.querySelector(".ad-form__photo"),i=["jpg","png"];n.addEventListener("change",(()=>{const e=n.files[0],t=e.name.toLowerCase();if(i.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{c.src=t.result})),t.readAsDataURL(e)}})),s.addEventListener("change",(()=>{const e=s.files[0],t=e.name.toLowerCase();if(i.some((e=>t.endsWith(e)))){const t=new FileReader,o=document.createElement("img");o.width=70,o.height=70,u.appendChild(o),t.addEventListener("load",(()=>{o.src=t.result})),t.readAsDataURL(e)}})),e.addEventListener("change",(()=>{switch(e.value){case"palace":t.min=1e4,t.placeholder=1e4;break;case"flat":t.min=1e3,t.placeholder=1e3;break;case"house":t.min=5e3,t.placeholder=5e3;break;case"bungalow":t.min=0,t.placeholder=0}})),o.addEventListener("change",(function(){switch(o.value){case"12:00":a.value="12:00";break;case"13:00":a.value="13:00";break;case"14:00":a.value="14:00"}})),a.addEventListener("change",(()=>{switch(a.value){case"12:00":o.value="12:00";break;case"13:00":o.value="13:00";break;case"14:00":o.value="14:00"}})),l.addEventListener("change",(()=>{r.setCustomValidity(""),"1"===l.value&&r.value>"1"||"1"===l.value&&"0"===r.value?l.setCustomValidity("в одну комнату один гость"):"2"===l.value&&r.value>"2"?l.setCustomValidity("Маловато комнат"):"2"===l.value&&"0"===r.value?l.setCustomValidity("Многовато гостей для двух комнат"):"3"===l.value&&"0"===r.value?l.setCustomValidity("Нужно больше комнат"):"100"===l.value&&r.value>0?l.setCustomValidity("Слишком много комнат"):l.setCustomValidity(""),l.reportValidity()})),r.addEventListener("change",(()=>{l.setCustomValidity(""),"1"===l.value&&r.value>"1"||"1"===l.value&&"0"===r.value?r.setCustomValidity("в одну комнату один гость"):"2"===l.value&&r.value>"2"||"2"===l.value&&"0"===r.value?r.setCustomValidity("Многовато гостей для двух комнат"):"3"===l.value&&"0"===r.value?r.setCustomValidity("Нужно больше комнат"):"100"===l.value&&r.value>0?(r.setCustomValidity("Слишком много комнат"),l.setCustomValidity("")):r.setCustomValidity(""),r.reportValidity()}))}},t={};function o(a){var r=t[a];if(void 0!==r)return r.exports;var l=t[a]={exports:{}};return e[a](l,l.exports,o),l.exports}(()=>{"use strict";const e=document.querySelector(".ad-form"),t=e.children,a=document.querySelector(".map__filters"),r=a.children;for(let e=0;e<r.length;e++)r[e].setAttribute("disabled","disabled");a.classList.add("ad-form--disabled");for(let e=0;e<t.length;e++)t[e].setAttribute("disabled","disabled");e.classList.add("ad-form--disabled");const l=document.querySelector("#address"),n=L.map("map-canvas").on("load",(()=>{(()=>{e.classList.remove("ad-form--disabled");for(let e=0;e<t.length;e++)t[e].removeAttribute("disabled","disabled");for(let e=0;e<r.length;e++)r[e].removeAttribute("disabled","disabled");a.classList.remove("ad-form--disabled")})()})).setView({lat:35.41255,lng:139.41238},10);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(n);const c=L.icon({iconUrl:"./leaflet/img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]});let s=L.marker({lat:35.41255,lng:139.41238},{draggable:!0,icon:c});s.addTo(n);const u=L.icon({iconUrl:"./leaflet/img/pin.svg",iconSize:[40,40],iconAnchor:[20,40]});l.value=Object.values(s._latlng),s.on("move",(e=>{let t=Object.values(e.target.getLatLng());l.value=t[0].toFixed(5)+", "+t[1].toFixed(5)}));const i={GET:"https://23.javascript.pages.academy/keksobooking/data",POST:"https://23.javascript.pages.academy/keksobooking"},d=document.querySelector(".map__filters");d.addEventListener("change",(()=>{n.closePopup()}));const p=document.querySelector("#housing-features"),m=e=>{const t=document.querySelector("#housing-type"),o=document.querySelector("#housing-price"),a=document.querySelector("#housing-rooms"),r=document.querySelector("#housing-guests"),l=p.querySelectorAll(":checked");let n=!0;if(0!==l.length&&e.offer.features&&l.length>e.offer.features.length&&(console.log(l),n=!1),0!==l.length&&e.offer.features){let t=0;for(let o=0;o<l.length;o++)e.offer.features.includes(l[o].value)&&(t+=1);t!==l.length&&(n=!1)}return 0===l.length||e.offer.features||(n=!1),(t.value===e.offer.type||"any"===t.value)&&("middle"===o.value&&e.offer.price>1e4&&e.offer.price<5e4||"any"===o.value||"low"===o.value&&e.offer.price<1e4||"any"===o.value||"high"===o.value&&e.offer.price>5e4||"any"===o.value)&&(Number(a.value)===e.offer.rooms||"any"===a.value)&&(Number(r.value)===e.offer.guests||"any"===r.value)&&n};let h;const v=document.querySelector("#card").content.querySelector(".popup"),y=document.createDocumentFragment(),f=e=>{const t=document.querySelector(".leaflet-marker-pane");for(let e=y.children.length-1;e>=0;e--)y.removeChild(y.children[e]);for(let e=t.children.length-1;e>0;e--)t.removeChild(t.children[e]);return e.slice().filter(m).slice(0,10).forEach((({author:e,location:t,offer:o},a)=>{const r=v.cloneNode(!0);switch(r.querySelector(".popup__title").textContent=o.title,r.querySelector(".popup__text--address").textContent=o.address,r.querySelector(".popup__text--price").textContent=o.price+" ₽/ночь",o.type){case"bungalow":r.querySelector(".popup__type").textContent="Бунгало";break;case"flat":r.querySelector(".popup__type").textContent="Квартира";break;case"hotel":r.querySelector(".popup__type").textContent="Отель";break;case"house":r.querySelector(".popup__type").textContent="Дом";break;case"palace":r.querySelector(".popup__type").textContent="Дворец"}const l=o.guests,c=o.rooms;let s=" гостя",i=" комната";l>1&&(s=" гостей"),c>1&&(i=" комнаты"),c>4&&(i=" комнат"),r.querySelector(".popup__text--capacity").textContent=c+i+" для "+l+s,r.querySelector(".popup__text--time").textContent="Заезд после "+o.checkin+", выезд до "+o.checkout;const d=r.querySelector(".popup__features");for(let e=d.children.length-1;e>=0;e--){const t=d.children[e];t.parentElement.removeChild(t)}try{for(let e=0;e<o.features.length;e++){const t=document.createElement("li");t.classList.add("popup__feature"),t.classList.add("popup__feature--"+o.features[e]),d.appendChild(t)}}catch(e){r.removeChild(d)}r.querySelector(".popup__description").textContent=o.description;let p=r.querySelector(".popup__photos img"),m=r.querySelector(".popup__photos");try{for(let e=0;e<o.photos.length-1;e++)m.appendChild(p.cloneNode())}catch(e){r.removeChild(m)}let f=m.children;try{for(let e=0;e<f.length;e++)f[e].src=o.photos[e]}catch(e){console.log("Нет фотографий: "+e.message,e.stack)}r.querySelector(".popup__avatar").src=e.avatar,y.appendChild(r),h=L.marker({lat:t.lat,lng:t.lng},{icon:u}),h.addTo(n).bindPopup(r)})),console.log(y),y};o(507),fetch(i.GET,{method:"GET",credentials:"same-origin",body:void 0}).then((e=>e.json())).then((e=>{(e=>{var t;f(e),t=_.debounce((()=>f(e)),500),d.addEventListener("change",t)})(e)})).catch((e=>{(e=>{alert("Ошибка загрузки данных "+e.stack)})(e)}))})()})();
//# sourceMappingURL=main.bundle.js.map